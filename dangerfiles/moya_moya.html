<div class="highlight"><pre><span class="c1"># Sometimes it&#39;s a README fix, or something like that - which isn&#39;t relevant for</span>
<span class="c1"># including in a project&#39;s CHANGELOG for example</span>
<span class="n">not_declared_trivial</span> <span class="o">=</span> <span class="o">!</span><span class="p">(</span><span class="n">github</span><span class="o">.</span><span class="n">pr_title</span><span class="o">.</span><span class="n">include?</span> <span class="s2">&quot;#trivial&quot;</span><span class="p">)</span>
<span class="n">has_app_changes</span> <span class="o">=</span> <span class="o">!</span><span class="n">git</span><span class="o">.</span><span class="n">modified_files</span><span class="o">.</span><span class="n">grep</span><span class="p">(</span><span class="sr">/Source/</span><span class="p">)</span><span class="o">.</span><span class="n">empty?</span>

<span class="c1"># Make it more obvious that a PR is a work in progress and shouldn&#39;t be merged yet</span>
<span class="nb">warn</span><span class="p">(</span><span class="s2">&quot;PR is classed as Work in Progress&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">github</span><span class="o">.</span><span class="n">pr_title</span><span class="o">.</span><span class="n">include?</span> <span class="s2">&quot;[WIP]&quot;</span>

<span class="c1"># Warn when there is a big PR</span>
<span class="nb">warn</span><span class="p">(</span><span class="s2">&quot;Big PR&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">git</span><span class="o">.</span><span class="n">lines_of_code</span> <span class="o">&gt;</span> <span class="mi">500</span>

<span class="c1"># Don&#39;t let testing shortcuts get into master by accident</span>
<span class="nb">fail</span><span class="p">(</span><span class="s2">&quot;fit left in tests&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="sb">`grep -r &quot;fit Demo/Tests/ `</span><span class="o">.</span><span class="n">length</span> <span class="o">&gt;</span> <span class="mi">1</span>

<span class="c1"># Changelog entries are required for changes to library files.</span>
<span class="n">no_changelog_entry</span> <span class="o">=</span> <span class="o">!</span><span class="n">git</span><span class="o">.</span><span class="n">modified_files</span><span class="o">.</span><span class="n">include?</span><span class="p">(</span><span class="s2">&quot;Changelog.md&quot;</span><span class="p">)</span>
<span class="k">if</span> <span class="n">has_app_changes</span> <span class="o">&amp;&amp;</span> <span class="n">no_changelog_entry</span> <span class="o">&amp;&amp;</span> <span class="n">not_declared_trivial</span>
  <span class="nb">fail</span><span class="p">(</span><span class="s2">&quot;Any changes to library code need a summary in the Changelog.&quot;</span><span class="p">)</span>
<span class="k">end</span>

<span class="c1"># Added (or removed) library files need to be added (or removed) from the</span>
<span class="c1"># Carthage Xcode project to avoid breaking things for our Carthage users.</span>
<span class="n">added_swift_library_files</span> <span class="o">=</span> <span class="n">git</span><span class="o">.</span><span class="n">added_files</span><span class="o">.</span><span class="n">grep</span><span class="p">(</span><span class="sr">/Source.*\.swift/</span><span class="p">)</span><span class="o">.</span><span class="n">empty?</span>
<span class="n">deleted_swift_library_files</span> <span class="o">=</span> <span class="n">git</span><span class="o">.</span><span class="n">deleted_files</span><span class="o">.</span><span class="n">grep</span><span class="p">(</span><span class="sr">/Source.*\.swift/</span><span class="p">)</span><span class="o">.</span><span class="n">empty?</span>
<span class="n">modified_carthage_xcode_project</span> <span class="o">=</span> <span class="o">!</span><span class="p">(</span><span class="n">git</span><span class="o">.</span><span class="n">deleted_files</span><span class="o">.</span><span class="n">grep</span><span class="p">(</span><span class="sr">/Moya\.xcodeproj/</span><span class="p">)</span><span class="o">.</span><span class="n">empty?</span><span class="p">)</span>
<span class="k">if</span> <span class="p">(</span><span class="n">added_swift_library_files</span> <span class="o">||</span> <span class="n">deleted_swift_library_files</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">modified_carthage_xcode_project</span>
  <span class="nb">fail</span><span class="p">(</span><span class="s2">&quot;Added or removed library files require the Carthage Xcode project to be updated.&quot;</span><span class="p">)</span>
<span class="k">end</span>

<span class="n">missing_doc_changes</span> <span class="o">=</span> <span class="n">git</span><span class="o">.</span><span class="n">modified_files</span><span class="o">.</span><span class="n">grep</span><span class="p">(</span><span class="sr">/docs/</span><span class="p">)</span><span class="o">.</span><span class="n">empty?</span>
<span class="n">doc_changes_recommended</span> <span class="o">=</span> <span class="n">git</span><span class="o">.</span><span class="n">insertions</span> <span class="o">&gt;</span> <span class="mi">15</span>
<span class="k">if</span> <span class="n">has_app_changes</span> <span class="o">&amp;&amp;</span> <span class="n">missing_doc_changes</span> <span class="o">&amp;&amp;</span> <span class="n">doc_changes_recommended</span> <span class="o">&amp;&amp;</span> <span class="n">not_declared_trivial</span>
  <span class="nb">warn</span><span class="p">(</span><span class="s2">&quot;Consider adding supporting documentation to this change. Documentation can be found in the `docs` directory.&quot;</span><span class="p">)</span>
<span class="k">end</span>

<span class="c1"># Warn when either the podspec or Cartfile + Cartfile.resolved has been updated,</span>
<span class="c1"># but not both.</span>
<span class="n">podspec_updated</span> <span class="o">=</span> <span class="o">!</span><span class="n">git</span><span class="o">.</span><span class="n">modified_files</span><span class="o">.</span><span class="n">grep</span><span class="p">(</span><span class="sr">/Moya.podspec/</span><span class="p">)</span><span class="o">.</span><span class="n">empty?</span>
<span class="n">cartfile_updated</span> <span class="o">=</span> <span class="o">!</span><span class="n">git</span><span class="o">.</span><span class="n">modified_files</span><span class="o">.</span><span class="n">grep</span><span class="p">(</span><span class="sr">/Cartfile/</span><span class="p">)</span><span class="o">.</span><span class="n">empty?</span>
<span class="n">cartfile_resolved_updated</span> <span class="o">=</span> <span class="o">!</span><span class="n">git</span><span class="o">.</span><span class="n">modified_files</span><span class="o">.</span><span class="n">grep</span><span class="p">(</span><span class="sr">/Cartfile.resolved/</span><span class="p">)</span><span class="o">.</span><span class="n">empty?</span>

<span class="k">if</span> <span class="n">podspec_updated</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="o">!</span><span class="n">cartfile_updated</span> <span class="o">||</span> <span class="o">!</span><span class="n">cartfile_resolved_updated</span><span class="p">)</span>
  <span class="nb">warn</span><span class="p">(</span><span class="s2">&quot;The `podspec` was updated, but there were no changes in either the `Cartfile` nor `Cartfile.resolved`. Did you forget updating `Cartfile` or `Cartfile.resolved`?&quot;</span><span class="p">)</span>
<span class="k">end</span>

<span class="k">if</span> <span class="p">(</span><span class="n">cartfile_updated</span> <span class="o">||</span> <span class="n">cartfile_resolved_updated</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">podspec_updated</span>
  <span class="nb">warn</span><span class="p">(</span><span class="s2">&quot;The `Cartfile` or `Cartfile.resolved` was updated, but there were no changes in the `podspec`. Did you forget updating the `podspec`?&quot;</span><span class="p">)</span>
<span class="k">end</span>

<span class="c1"># Run SwiftLint</span>
<span class="n">swiftlint</span><span class="o">.</span><span class="n">lint_files</span>
</pre></div>